openapi: 3.0.3
# --------------------------------------------
# Info
info:
  title: Book Collection API
  version: v1.0.0
  description: A simple API to manage a collection of books.
  termsOfService: 'https://github.com/methods/S_BookAPIV.2'
  contact:
    email: booksAPI@example.com
  license:
    name: MIT License
    url: 'https://github.com/methods/S_BookAPIV.2/blob/main/LICENSE.md'

# --------------------------------------------
# Server
servers:
  - url: http://localhost:5000
    description: Development server

# --------------------------------------------
# Tags
tags:
  - name: Books
    description: Operations related to books
  - name: Reservations
    description: Operations related to book reservations
  - name: Authentication
    description: Operations related to user registration and login

# --------------------------------------------
# Components
components:
  # ... securitySchemes remain the same ...
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-KEY
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: "Enter JWT Bearer token"

  parameters:
    BookId:
      name: book_id
      in: path
      required: true
      description: The unique identifier of the book (standard UUID format).
      schema:
        type: string
        format: uuid # UPDATED: Using UUID format
        example: "a1b2c3d4-e5f6-7890-1234-567890abcdef" # UPDATED: Example UUID
    ReservationId:
      name: res_id
      in: path
      required: true
      description: The unique identifier of the reservation (standard UUID format).
      schema:
        type: string
        format: uuid # UPDATED: Using UUID format
        example: "b1c2d3e4-f5a6-7890-1234-567890fedcba" # UPDATED: Example UUID
    Offset:
      # ... remains the same ...
      name: offset
      in: query
      description: The number of items to skip before starting to collect the result set. Must be a positive number and not exceed the system maximum.
      required: false
      schema:
        type: integer
        default: 0
        minimum: 0
    Limit:
      # ... remains the same ...
      name: limit
      in: query
      description: The maximum number of items to return. Must be a positive number and not exceed the system maximum.
      required: false
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 1000

  schemas:
    # --- Book Schemas ---
    BookInput:
      # ... remains the same ...
      type: object
      required:
        - title
        - synopsis
        - author
      properties:
        title:
          type: string
          example: "The Hitchhiker's Guide to the Galaxy"
        synopsis:
          type: string
          example: "Seconds before the Earth is demolished to make way for a galactic freeway..."
        author:
          type: string
          example: "Douglas Adams"

    # Schema for the HATEOAS links object (No change to format, but target IDs will be UUIDs)
    Links:
      # ... remains the same ...
      type: object
      required:
        - self
        - reservations
        - reviews
      properties:
        self:
          type: string
          description: Link to the book resource itself.
          format: uri
        reservations:
          type: string
          description: Link to reservations for this book.
          format: uri
        reviews:
          type: string
          description: Link to reviews for this book.
          format: uri

    # Schema for the full Book object as returned by the server
    BookOutput:
      allOf:
        - $ref: '#/components/schemas/BookInput'
      properties:
        id:
          type: string
          format: uuid # UPDATED: Explicit UUID format
          description: The unique identifier for the book, generated by the server (UUID).
          readOnly: true
          example: "a1b2c3d4-e5f6-7890-1234-567890abcdef" # UPDATED: Example UUID
        links:
          $ref: '#/components/schemas/Links'
          readOnly: true

    # Schema for the full Books Database Object as returned by the server
    BookListResponse:
      # ... remains the same ...
      type: object
      properties:
        total_count:
          type: integer
          description: Total number of books
          example: 3
        items:
          type: array
          items:
            $ref: '#/components/schemas/BookOutput'

    # ----- AUTH schemas -------------

    UserOutput:
      type: object
      properties:
        id:
          type: string
          format: uuid # UPDATED: User ID is now UUID
          readOnly: true
          example: "c1d2e3f4-g5h6-7890-1234-567890abcdef" # UPDATED: Example UUID
        email:
          type: string
          format: email
          readOnly: true
          example: "newuser@example.com"


    # ------- Reservation schemas ----------

    # ... ReservationUserOutput remains the same ...
    # Schema for the PUT /reservations/{res_id} request body
    ReservationUserOutput:
      type: object
      properties:
        forenames:
          type: string
          example: "John"
        middlenames:
          type: string
          example: "Fitzgerald"
        surname:
          type: string
          example: "Doe"

    # ... ReservationLinks remains the same ...
    ReservationLinks:
      type: object
      properties:
        self:
          type: string
          format: uri
          description: A link to the reservation resource itself.
        book:
          type: string
          format: uri
          description: A link to the parent book resource.
      readOnly: true

    # Schema for the full Reservation object returned by the API
    ReservationOutput:
      type: object
      properties:
        id:
          type: string
          format: uuid # UPDATED: Reservation ID is UUID
          description: The unique identifier for the reservation (UUID).
          example: "b1c2d3e4-f5a6-7890-1234-567890fedcba" # UPDATED: Example UUID
        state:
          type: string
          description: The current state of the reservation.
          example: "reserved"
          readOnly: true
        user_id:
          type: string
          format: uuid # UPDATED: User ID is UUID
          description: The ID of the user who made the reservation (UUID).
          example: "c1d2e3f4-g5h6-7890-1234-567890abcdef" # UPDATED: Example UUID
        book_id:
          type: string
          format: uuid # UPDATED: Book ID is UUID
          description: The ID of the book being reserved (UUID).
          example: "a1b2c3d4-e5f6-7890-1234-567890abcdef" # UPDATED: Example UUID
        links:
          $ref: '#/components/schemas/ReservationLinks'
        reservationDate:
          type: string
          format: date-time
          description: The timestamp when the reservation was made.
          example: "2023-10-27T10:00:00Z"

    # Schema for a paginated list of reservations
    ReservationListResponse:
      type: object
      properties:
        total_count:
          type: integer
          description: Total number of reservations for this book
          example: 5
        items:
          type: array
          items:
            $ref: '#/components/schemas/ReservationOutput'


  # ------ ERROR schemas ----------
  # Error examples that mention invalid ID formats would also need adjustment
  # ... (omitted for brevity, but this is the final check)